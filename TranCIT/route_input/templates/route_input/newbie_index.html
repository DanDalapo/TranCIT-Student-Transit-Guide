{% load static %}

<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TranCIT Prototype</title>
 <link rel="stylesheet" href="{% static 'route_input/css/newbie_styles.css' %}">
</head>
<body>

  <!-- Tutorial Overlay -->
  <div class="tutorial-overlay" id="tutorialOverlay">
    <div class="tutorial-box">
      <h2 id="tutorialTitle">Welcome to TranCIT!</h2>
      <p id="tutorialText">Let's take a quick tour to help you get started.</p>
      <div class="tutorial-steps" id="tutorialSteps"></div>
      <div class="tutorial-actions">
        <button class="skip-btn" id="skipTutorial">Skip Tutorial</button>
        <button class="next-btn" id="nextTutorial">Next</button>
      </div>
      <div class="tutorial-indicator" id="tutorialIndicator"></div>
    </div>
  </div>

  <!-- Top navigation -->
  <div class="topNav">
    <a href="#" class="logo">üöç TranCIT</a>
    <div class="search-box">
      <input type="text" placeholder="Search destination...">
    </div>

    <div class="nav-actions">
      
      <a href="{% url 'toggle_newbie_mode' %}" class="nav-btn" 
         style="background-color: #ffc107; color: #333;">
        Normal Mode
      </a>
      
      <button id="helpBtn" class="nav-btn">
        Help
      </button>

      {% if user.is_authenticated %}
        <a href="{% url 'logout' %}" class="nav-btn" 
           style="background-color: #dc3545;">
          Log out
        </a>
      {% else %}
        <a href="{% url 'login_registration:login' %}" class="nav-btn" 
           style="background-color: #6c757d;">
          Exit Guest
        </a>
      {% endif %}
      
    </div>
  </div>

  <div class="container">
    <!-- Left Panel -->
    <aside class="sidebar" id="sidebarPanel">
      <h3>Plan Your Route</h3>
      <form id="routeForm" method="post" novalidate>
        {% csrf_token %}

        <label>From</label>
        <input type="text" name="origin" placeholder="Your current location" required>
        <span class="error" id="error-origin"></span>

        <label>To</label>
        <input type="text" name="destination" placeholder="Where do you want to go?" required>
        <span class="error" id="error-destination"></span>

        <label>Transport</label>
        <select name="transport_type" required>
          <option value="">Choose transport type</option>
          <option>Jeepney</option>
          <option>Bus</option>
          <option>Taxi</option>
        </select>
        <span class="error" id="error-transport"></span>

        <label>Estimated Fare (‚Ç±)</label>
        <input type="number" name="fare" min="0" step="1" placeholder="Optional">
        <span class="error" id="error-fare"></span>

        <button type="submit" class="btn primary" id="navigateBtn">Find Route</button>
      </form>

      <div class="saved-locations">
        <h4>Saved Places</h4>
        <ul id="savedList">
          <li>No saved locations yet</li>
        </ul>
      </div>
    </aside>

    <!-- Map Area -->
    <main class="map-area" id="mapPanel">
      <div id="map-container">
        {{ map|safe }}
      </div>
    </main>

    <!-- Suggestions -->
    <aside class="suggestions" id="suggestionsPanel">
      <h3>Quick Tips</h3>
      <ul>
        <li>Jeepney 12I goes directly to CIT-U</li>
        <li>Take Bus 03A for Colon Street</li>
        <li>Taxi fare calculator available on the left</li>
      </ul>

      <h4 style="margin-top: 20px; margin-bottom: 10px; font-size: 0.95rem;">Share Your Tip</h4>
      <textarea placeholder="Know a better route? Share it here..."></textarea>
      <button class="btn primary">Submit Suggestion</button>
    </aside>

  </div>

  <script>
    // Tutorial System
    const tutorialSteps = [
      {
        title: "Welcome to TranCIT! üöç",
        text: "TranCIT helps you navigate through Cebu City using public transportation. Let's show you around!",
        steps: null,
        highlight: null
      },
      {
        title: "Plan Your Route",
        text: "Start by entering your journey details in the left panel.",
        steps: [
          "Enter your starting location",
          "Enter your destination",
          "Choose your preferred transport",
          "Click 'Find Route' to see your options"
        ],
        highlight: "sidebarPanel"
      },
      {
        title: "Interactive Map",
        text: "The center panel shows an interactive map of your route. You'll see:",
        steps: [
          "Your starting point and destination",
          "Suggested routes highlighted",
          "Transport stops along the way",
          "Estimated travel time"
        ],
        highlight: "mapPanel"
      },
      {
        title: "Helpful Suggestions",
        text: "The right panel provides useful information:",
        steps: [
          "Quick tips from other commuters",
          "Popular routes to common destinations",
          "Share your own route suggestions",
          "Save frequently visited places"
        ],
        highlight: "suggestionsPanel"
      },
      {
        title: "You're All Set! üéâ",
        text: "You're ready to start using TranCIT. Click the Help button anytime to see this tutorial again.",
        steps: null,
        highlight: null
      }
    ];

    let currentStep = 0;
    const overlay = document.getElementById('tutorialOverlay');
    const title = document.getElementById('tutorialTitle');
    const text = document.getElementById('tutorialText');
    const stepsContainer = document.getElementById('tutorialSteps');
    const indicator = document.getElementById('tutorialIndicator');
    const nextBtn = document.getElementById('nextTutorial');
    const skipBtn = document.getElementById('skipTutorial');
    const helpBtn = document.getElementById('helpBtn');

    function showTutorialStep(step) {
      const stepData = tutorialSteps[step];

      // Remove previous highlights
      document.querySelectorAll('.highlight-pulse').forEach(el => {
        el.classList.remove('highlight-pulse');
      });

      // Update content
      title.textContent = stepData.title;
      text.textContent = stepData.text;

      // Show steps if available
      if (stepData.steps) {
        stepsContainer.style.display = 'block';
        stepsContainer.innerHTML = '<ol>' +
          stepData.steps.map(s => `<li>${s}</li>`).join('') +
          '</ol>';
      } else {
        stepsContainer.style.display = 'none';
      }

      // Highlight element
      if (stepData.highlight) {
        const element = document.getElementById(stepData.highlight);
        if (element) {
          element.classList.add('highlight-pulse');
        }
      }

      // Update indicator
      indicator.textContent = `Step ${step + 1} of ${tutorialSteps.length}`;

      // Update button text
      if (step === tutorialSteps.length - 1) {
        nextBtn.textContent = 'Get Started';
      } else {
        nextBtn.textContent = 'Next';
      }
    }

    function startTutorial() {
      currentStep = 0;
      overlay.classList.add('active');
      showTutorialStep(currentStep);
    }

    function closeTutorial() {
      overlay.classList.remove('active');
      document.querySelectorAll('.highlight-pulse').forEach(el => {
        el.classList.remove('highlight-pulse');
      });
      // Save that user has seen tutorial
      localStorage.setItem('trancit_tutorial_seen', 'true');
    }

    nextBtn.addEventListener('click', () => {
      if (currentStep < tutorialSteps.length - 1) {
        currentStep++;
        showTutorialStep(currentStep);
      } else {
        closeTutorial();
      }
    });

    skipBtn.addEventListener('click', closeTutorial);

    helpBtn.addEventListener('click', startTutorial);

    // Show tutorial on first visit
    window.addEventListener('load', () => {
      const hasSeenTutorial = localStorage.getItem('trancit_tutorial_seen');
      if (!hasSeenTutorial) {
        setTimeout(startTutorial, 500);
      }
    });

    // Form validation (preserving your existing functionality)
    const form = document.getElementById('routeForm');
    form.addEventListener('submit', (e) => {
      e.preventDefault();

      // Clear previous errors
      document.querySelectorAll('.error').forEach(el => el.textContent = '');

      let isValid = true;

      // Validate origin
      const origin = form.origin.value.trim();
      if (!origin) {
        document.getElementById('error-origin').textContent = 'Please enter your location';
        isValid = false;
      }

      // Validate destination
      const destination = form.destination.value.trim();
      if (!destination) {
        document.getElementById('error-destination').textContent = 'Please enter a destination';
        isValid = false;
      }

      // Validate transport type
      const transport = form.transport_type.value;
      if (!transport) {
        document.getElementById('error-transport').textContent = 'Please select transport type';
        isValid = false;
      }

      if (isValid) {
        // Your form submission logic here
        console.log('Form is valid, submitting...');
        // form.submit(); // Uncomment when ready
      }
    });
  </script>

</body>
</html>